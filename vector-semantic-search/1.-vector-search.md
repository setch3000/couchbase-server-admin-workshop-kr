# 1. Vector Search 실습

## 벡터(Vector)란 무엇인가

벡터(Vector)는 실제 세계의 객체를 부동소수점 숫자들의 배열로 표현한 객체입니다.\
현실의 각 항목은 벡터 형식(배열 형태)으로 표현되며, 해당 객체의 특성에 따라 여러 차원(속성) 값을 가집니다.

예를 들어, 색상을 벡터 형식으로 표현하고자 한다면, 다음과 같이 속성값 배열을 만들 수 있습니다:

`예시: [ "R", "G", "B" ]`

RGB 이미지에서 각 색상은 빨강, 초록, 파랑의 강도를 나타내는 세 값으로 표현됩니다.

이 값들은 일반적으로 0부터 255까지의 범위를 가지며, 각 색상 구성 요소의 세기를 의미합니다.

예: `순수한 빨강(Pure Red) = [ "255", "0", "0" ]`

* 여기서,  R: 빨강의 강도 (이 경우 최대 강도 255),  G: 초록의 강도 (이 경우 0, 즉 초록 없음), B: 파랑의 강도 (이 경우 0, 즉 파랑 없음)

이와 같은 RGB 벡터 형식을 사용하면, 0\~255 범위의 값을 각 색상 채널에 지정하여 모든 색상을 표현할 수 있습니다.

만약 “빨강색과 유사한 색”을 찾고자 한다면, 첫 번째 속성 값(R)이 유사한 항목을 기준으로 가까운 색상을 찾을 수 있습니다.\
현실 세계의 객체들은 훨씬 더 많은 속성(특징)을 가질 수 있으므로, 이를 표현하는 벡터는 512, 1028, 1536, 2048 등의 크기를 가진 큰 배열로 나타나기도 합니다.\


## 벡터 검색(Vector Search)이란 무엇인가

**벡터 검색(Vector Search)**&#xC740; 벡터 표현을 기반으로 항목을 찾는 방법입니다.\
이때 각 항목은 다차원 공간에 표현되며, 각 차원은 해당 항목의 속성 값을 나타냅니다.\
즉, 벡터 검색은 “속성 간의 유사도”를 기준으로 데이터를 찾는 유사도 기반 검색(Similarity Search) 방식입니다.



## 벡터 검색을 위한 샘플 데이터 생성하기

1. [`rgb.json`](https://drive.google.com/file/d/1-uTH-SFw4cQdTiPaysGSUHyY4T9o_BtM/view?usp=share_link) 파일을 다운로드 받습니다.
2. Capella UI를 열고 Database로 이동한 뒤, Data Tools에서 “Import from browser” 기능을 사용하여 데이터를 가져옵니다.

<figure><img src="../.gitbook/assets/image (31).png" alt=""><figcaption></figcaption></figure>



3. Load from browser 옵션을 선택합니다.
4. 파일 선택: rgb.json (사전 준비 단계에서 제공된 rgb.json 샘플 데이터 파일을 사용합니다.)

<figure><img src="../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>



5. 새 버킷 이름 지정: vector-sample
6. 새 스코프 이름 지정: color
7. 새 컬렉션 이름 지정: rgb



<figure><img src="../.gitbook/assets/image (33).png" alt=""><figcaption></figcaption></figure>



8. 각 문서의 식별자를 생성하는 방법을 선택합니다. Field를 선택하고, 필드 이름을 Id로 지정합니다 (아래 스크린샷 참고).
9. 그런 다음, Import를 클릭하여 데이터를 가져옵니다.

<figure><img src="../.gitbook/assets/image (34).png" alt=""><figcaption></figcaption></figure>





## 벡터 검색 인덱스 생성하기

1. [color-index.json](https://drive.google.com/file/d/16seOvrs3h5DnPQSsLrbVCSn02pkslVq9/view?usp=share_link) 파일을 다운로드 받습니다.
2. Data Tools의 Search 탭으로 이동합니다.

<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>



3. Create Search Index를 클릭합니다.

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



4. UI 오른쪽에 있는 Import from file 옵션을 선택합니다.
5. 이전 단계에서 다운로드 받은 color-index.json 파일을 선택힙니다.

<figure><img src="../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



6. Index Name을 `color-index` 으로 지정합니다.
7. Bucket은 `vector-sample`을 선택합니다.
8. Scope는 자동으로 `color`로 설정됩니다.

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

\
9\. 나머지 설정은 그래두 두고 `Create Index`를 클릭하여 인덱스를 생성합니다.

<figure><img src="../.gitbook/assets/image (35).png" alt=""><figcaption></figcaption></figure>



## 벡터 검색 수행하기

오른쪽 끝 근처에 있는 버튼을 클릭하여 color-index 행에서 Search 옵션을 선택합니다.

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>



하기 쿼리를 Search 창에 붙여넣습니다.

`{ "fields": ["*"], "query": { "match_none": "" }, "knn": [ { "k": 2, "field": "colorvect_l2", "vector": [ 0, 0, 128 ] } ] }`



그런 다음 `Search` 버튼을 클릭하면, 아래 창에 결과가 표시됩니다.\


<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>



다음과 같이 벡터 필드 뿐만 아니라, 텍스트 필드도 쿼리 조건에 추가하여 hybrid search도 가능합니다.

하기 쿼리를 Search 창에 붙여넣습니다.



`{ "query": { "field": "brightness", "min": 70, "max": 80, "inclusive_min": false, "inclusive_max": true }, "knn": [ {"field": "colorvect_l2", "vector": [0.0, 0.0, 108.0], "k": 5} ], "fields": ["color","brightness"], "size": 5 }`



그런 다음 `Search` 버튼을 클릭하면, 아래 창에 결과가 표시됩니다.\


<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>



수고하셨습니다.





