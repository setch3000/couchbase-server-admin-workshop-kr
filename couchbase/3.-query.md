# 3. Query 최적화

쿼리에 지정된 모든 필드의 실제 값이 인덱스에 포함되어 있을 때, 해당 인덱스는 쿼리를 **커버(Cover)**&#xD55C;다고 하며 데이터 서비스로부터 실제 값을 가져오는 추가 단계(Fetch)를 거치지 않습니다. 이 경우의 인덱스를 **커버링 인덱스(Covering Index)**&#xB77C; 부르고, 해당 쿼리를 **커버드 쿼리(Covered Query)**&#xB77C;고 합니다. 결과적으로 커버드 쿼리는 속도가 더 빠르며 더 나은 성능을 제공합니다.

금번에는 이러한 커버드 쿼리(Covered Query) 실습을 진행합니다.





### 커버드 쿼리(Covered Query) 실습 #1

먼저 Operational Clusters / Data Tools > Query를 선택합니다. 그런 다음 아래 쿼리를 사용하여 Covering Index를 먼저 생성합니다.

```
CREATE INDEX idx_flight_covering
ON `travel-sample`(
    sourceairport,
    destinationairport,
    utc_departure,
    airline
)
WHERE type = "route";
```

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>



인덱스 생성이 완료되면 다음 쿼리를 실행합니다.

```
SELECT
    sourceairport,
    destinationairport,
    utc_departure,
    airline
FROM `travel-sample`
WHERE type = "route"
  AND sourceairport = "SFO"
  AND destinationairport = "LAX"
ORDER BY utc_departure
LIMIT 20;
```



다음과 같이 쿼리 결과를 확인하실 수 있습니다.

<figure><img src="../.gitbook/assets/image (49).png" alt=""><figcaption></figcaption></figure>



Plan 탭을 클릭하여 보시면, 서비스로부터 실제 값을 가져오는 추가 단계(Fetch)를 거치지 않는 것을 확인하실 수 있습니다.

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>





### 커버드 쿼리(Covered Query) 실습 #2



```
CREATE INDEX idx_hotel_city_rating_covering
ON `travel-sample` (
 city,
 rating DESC,
 country,
 name,
 address,
 price
)
WHERE type = "hotel";
```



