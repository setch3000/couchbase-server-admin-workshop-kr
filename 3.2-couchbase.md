# 3.2 새 노드에 Couchbase 설치

이 섹션에서는 \*\*5개의 새 노드(연한 파란색, 초록색, 노란색 PuTTY 창)\*\*에서 다음 작업을 수행합니다.

아래 단계들은 총 다섯 번 반복해야 합니다. • 2번 노드에서 한 번, • 3번 노드에서 한 번, • 4번 노드에서 한 번, • 5번 노드에서 한 번, • 6번 노드에서 한 번입니다.

먼저 \*\*2번 노드(연한 파란색 창)\*\*에서 작업을 실행한 뒤, 다시 돌아와 동일한 단계를 3번, 4번, 5번, 6번 노드에서도 수행합니다.

자, 그럼 시작하겠습니다. \*\*2번 노드(연한 파란색 창)\*\*로 전환하고 아래 단계를 실행합니다.&#x20;



\- 루프 시작 -

## 1. Swappiness 비활성화

Swappiness 수준은 Linux 가상 메모리 서브시스템이 디스크로 스왑을 얼마나 시도할지를 결정합니다. 문제는 시스템에 RAM이 충분히 있음에도 불구하고 메모리에 있는 항목을 디스크로 스왑하려고 한다는 점입니다.\
현재 VM에 설정된 값을 확인하려면 다음을 실행하세요:

```bash
[ec2-user@Couchbase01 ~]$ cat /proc/sys/vm/swappiness
30
```



실행 중인 시스템에서 스와핑을 끄되, 먼저 root 사용자로 전환하세요:

```
[ec2-user@Couchbase01~]$ sudo -s
[root@Couchbase01 ec2-user ~] echo 0 > /proc/sys/vm/swappiness
```



그 다음, sysctl.conf 파일에서 이 변경 사항을 영구적으로 적용하여 재부팅 후에도 설정이 유지되도록 합니다 (재부팅은 하지 마세요!).\
이후 root 사용자 모드를 종료하세요.



{% hint style="info" %}
이 모든 echo 명령어는 한 줄에 입력해야 하며, CMD 프롬프트에서 두 줄로 나누어 입력하지 마세요!
{% endhint %}

```bash

[root@couchbase01 ec2-user] echo '' >> /etc/sysctl.conf
​
[root@couchbase01 ec2-user] echo '#Set swappiness to 0 to avoid swapping' >> /etc/sysctl.conf
​
[root@couchbase01 ec2-user] echo 'vm.swappiness = 0' >> /etc/sysctl.conf
```





## 2. Transparent Huge Pages 비활성화

Transparent Huge Pages(THP)는 작은 메모리 페이지를 자동으로 큰 페이지로 묶어 관리하는 리눅스 기능이지만, 데이터베이스 환경에서는 오히려 성능 저하를 유발하기 때문에 비활성화(disable) 하는 것이 일반적인 모범 사례입니다. \
운영 환경의 Couchbase 클러스터에서는 각 노드에서 Transparent Huge Pages를 비활성화하는 것이 매우 중요합니다.&#x20;

(명령어는 반드시 한 줄로 입력해야 함을 기억하세요)

```bash
# Disable THP on a running system
[root@Couchbase01 ec2-user]  echo never > /sys/kernel/mm/transparent_hugepage/enabled
[root@Couchbase01 ec2-user]  echo never > /sys/kernel/mm/transparent_hugepage/defrag
```





## 3. Couchbase 설치

메타 패키지를 다운로드하세요.&#x20;

```bash
curl -O https://packages.couchbase.com/releases/couchbase-release/couchbase-release-1.0.noarch.rpm
```



메타 패키지를 설치합니다. 메타 패키지는 yum이 Couchbase Server 설치에 필요한 모든 패키지와 의존성을 가져올 수 있도록 필요한 정보를 설치합니다.

```bash
sudo rpm -i ./couchbase-release-1.0.noarch.rpm
```



Couchbase Server를 설치합니다.

```bash
sudo yum install couchbase-server
```



Couchbase Server(및 필요한 의존성) 다운로드를 시작하고, 여러 개의 GPG 키를 가져오라는 메시지가 표시됩니다. 각 메시지에서 y를 입력하여 승인하고 계속 진행하세요.



```
Transaction Summary
=========================================================================================================================================
Install  1 Package

Total download size: 542 M
Installed size: 1.5 G
Is this ok [y/N]: y
Downloading Packages:
couchbase-server-enterprise-7.6.7-linux.x86_64.rpm                                                        15 MB/s | 542 MB     00:36    
-----------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                     15 MB/s | 542 MB     00:36     
Couchbase release linux x86_64 yum repository                                                            1.6 MB/s | 1.7 kB     00:00    
Importing GPG key 0xE9CB0900:
 Userid     : "Couchbase Repository Key (For signing yum/apt repositories) <build-team@couchbase.com>"
 Fingerprint: 359E 9675 6BB3 F419 D4B2 6560 9BBE 2052 E9CB 0900
 From       : /etc/pki/rpm-gpg/GPG-KEY-COUCHBASE-2.0
Is this ok [y/N]: y
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                 1/1 
  Running scriptlet: couchbase-server-7.6.7-6706.x86_64                                                                              1/1 
Minimum RAM required  : 4 GB
System RAM configured : 7.50 GB

Minimum number of processors required : 4 cores
Number of processors on the system    : 2 cores


  Installing       : couchbase-server-7.6.7-6706.x86_64                                                                              1/1 
  Running scriptlet: couchbase-server-7.6.7-6706.x86_64                                                                              1/1 
Created symlink '/etc/systemd/system/multi-user.target.wants/couchbase-server.service' → '/usr/lib/systemd/system/couchbase-server.service'.

You have successfully installed Couchbase Server.
Please browse to http://Couchbase01:8091/ to configure your server.
Refer to https://docs.couchbase.com for additional resources.

Please note that you have to update your firewall configuration to
allow external connections to a number of network ports for full
operation. Refer to the documentation for the current list:
https://docs.couchbase.com/server/7.6/install/install-ports.html

By using this software you agree to the End User License Agreement.
See /opt/couchbase/LICENSE.txt.


Installed products updated.

Installed:
  couchbase-server-7.6.7-6706.x86_64                                                                                                     

Complete!
[root@Couchbase01 ~]# 
```

위의 메시지가 보인다면 Couchbase가 성공적으로 설치된 것입니다.



## 4. 시스템 상태 확인

설치가 완료된 후 20초 정도 기다린 다음, Couchbase Server의 상태를 확인합니다:

```
systemctl status couchbase-server
```

만약 방금 `2번 노드(연한 파란색)`에서 작업을 끝냈다면, 문서를 위로 몇 페이지 스크롤하여 `-루프 시작-` 라고 표시된 부분부터 3번, 4번, 5번, 6번 노드에서도 이 단계를 반복해 주십시오.

