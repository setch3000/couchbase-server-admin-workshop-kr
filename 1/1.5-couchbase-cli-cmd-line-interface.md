# 1.5 Couchbase CLI(cmd-line interface) 탐색

couchbase-cli 도구는 Couchbase 클러스터, 노드, 버킷에 대한 다양한 관리 작업을 제공합니다.

\
이 도구는 Linux에서 다음 경로에 위치해 있습니다:

```
/opt/couchbase/bin/couchbase-cli
```



### Linux의 PATH에 /opt/couchbase/bin 디렉토리를 추가합니다.

Linux의 PATH에 /opt/couchbase/bin 디렉토리를 추가하면, 전체 디렉토리 경로를 입력하지 않고도 단순히 couchbase-cli라고 입력해 couchbase-cli 도구(및 기타 도구)를 실행할 수 있습니다.

참고로, 다음 단계에서는 Linux 텍스트 편집기를 사용해야 합니다. XML 파일 및 이후의 모든 파일을 열 때는 nano, vi, vim, emacs 중 하나를 사용할 수 있습니다. 만약 vi/vim 또는 emacs 문법에 익숙하지 않다면, Linux에서 가장 간단한 편집기 중 하나인 nano 사용을 권장합니다.

저는 vi와 vim을 선호하기 때문에 이후 실습에서는 이 두 편집기로 파일을 열겠지만, 필요하다면 명령어에서 vi나 vim을 nano 또는 emacs로 바꿔서 사용하셔도 됩니다.

{% hint style="info" %}
vi/vim에 대한 3분 크래시 코스를 원하신다면, 다음 링크로 이동하여 레벨 1과 2를 완료한 뒤 돌아오세요:

http://yannesposito.com/Scratch/en/blog/Learn-Vim-Progressively/
{% endhint %}



### .bash\_profile 파일을 편집합니다.

```bash
[ec2-user@ Couchbase01 ~]$ cd ~
[ec2-user@ Couchbase01 ~]$ vi .bash_profile
```

파일에 9-26번째 줄을 추가할 예정입니다.

현재 파일에는 다음과 같이 1-8번째 줄이 표시되어 있을 것입니다:

```bash
      1.bash_profile
      2
      3 # Get the aliases and functions
      4 if [ -f ~/.bashrc ]; then
      5         . ~/.bashrc
      6 fi
      7
      8 # User specific environment and startup programs
```

9-12번째 줄은 PATH와 MANPATH 변수를 위한 것입니다.

```bash
      9 PATH=$PATH:/opt/couchbase/bin
     10 export PATH
     11 MANPATH=$MANPATH:/opt/couchbase/share/man
     12 export MANPATH
```



노드 이름과 USERNAME & PASSWORD 변수를 추가합니다(대략 13번째 줄).

파일 끝에 다음 줄들을 추가하고, 이 과정 초반에 제공된 AMAZON 전역 DNS 이름으로 노드 이름을 교체하세요. 마지막으로 couchbase REST\_USERNAME과 REST\_PASSWORD 선언으로 마무리합니다.

모든 변수를 export하는 것도 잊지 마세요.

```bash
  13  AppServer=ec2-48-54-199-69.us-west-1.compute.amazonaws.com
  14  export AppServer

  15  NODE1=ec2-113-156-188-191.us-west-1.compute.amazonaws.com
  16  NODE2=ec2-115-156-209-124.us-west-1.compute.amazonaws.com
  17  NODE3=ec2-113-157-200-184.us-west-1.compute.amazonaws.com
  18  NODE4=ec2-118-144-149-199.us-west-1.compute.amazonaws.com
  19  NODE5=ec2-154-183-155-127.us-west-1.compute.amazonaws.com
  20  NODE6=ec2-154-183-183-230.us-west-1.compute.amazonaws.com
  21  NODE7=ec2-154-219-170-126.us-west-1.compute.amazonaws.com
  22  NODE8=ec2-154-219-174-110.us-west-1.compute.amazonaws.com

  23  export NODE1 NODE2 NODE3 NODE4 NODE5 NODE6 NODE7 NODE8

  24  CB_REST_USERNAME=Administrator
  25  CB_REST_PASSWORD=couchbase
  26  export CB_REST_USERNAME CB_REST_PASSWORD
```

source 명령을 실행하고, vi 또는 nano 세션을 저장하고 종료합니다.



.bash\_profile 파일을 source 명령으로 실행합니다.

.bashrc 파일을 source 명령으로 실행하여, 변경 사항이 현재 bash 세션에 적용되도록 합니다.



```bash
[ec2-user@ Couchbase01 ~]$ source ~/.bash_profile
```

```bash
[ec2-user@ Couchbase01 ~]$ couchbase-cli
```

```
usage: couchbase-cli [-h]  ...

Commands:

    bucket-compact            Compact database and view data
    bucket-create             Add a new bucket to the cluster
    bucket-delete             Delete an existing bucket
    bucket-edit               Modify settings for an existing bucket
    bucket-flush              Flush all data from disk for a given bucket
    bucket-list               List all buckets in a cluster
    cluster-init              Initialize a Couchbase cluster
    collect-logs-start        Start cluster log collection
    collect-logs-status       View the status of cluster log collection
    collect-logs-stop         Stop cluster log collection
    collection-manage         Manage collections in a bucket
    enable-developer-preview  Enable developer preview mode in target cluster
    eventing-function-setup   Manage Eventing Service Functions
    failover                  Failover one or more servers
    group-manage              Manage server groups
    host-list                 List all hosts in a cluster
    ip-family                 Change or get the address family
    master-password           Unlocking the master password
    node-init                 Set node specific settings
    node-to-node-encryption   Change or get the cluster encryption
                              configuration
    rebalance                 Start a cluster rebalancing
    rebalance-status          Show rebalance status
    rebalance-stop            Stop a rebalance
    recovery                  Recover one or more servers
    reset-admin-password      Resets the administrator password
    reset-cipher-suites       Rests cipher suites to the default
    server-add                Add servers to the cluster
    server-info               Show details of a node in the cluster
    server-list               List all nodes in a cluster
    setting-alert             Modify email alert settings
    setting-alternate-address
                              Configure alternate addresses
    setting-audit             Modify audit settings
    setting-autofailover      Modify auto failover settings
    setting-autoreprovision   Modify auto-reprovision settings
    setting-cluster           Modify cluster settings
    setting-compaction        Modify auto-compaction settings
    setting-index             Modify index settings
    setting-ldap              Modify LDAP settings
    setting-master-password   Changing the settings of the master password
    setting-notification      Modify email notification settings
    setting-password-policy   Modify the password policy
    setting-query             Manage query settings
    setting-rebalance         Configure automatic rebalance settings
    setting-saslauthd         Modify saslauthd settings
    setting-security          Modify security settings
    setting-xdcr              Modify XDCR related settings
    ssl-manage                Manage cluster certificates
    user-change-password      Change user password
    user-manage               Manage RBAC users
    xdcr-replicate            Manage XDCR cluster references
    xdcr-setup                Manage XDCR replications

Options:
  -h,--help                   Prints the short or long help message
  --version version           Get couchbase-cli version
```

\




### `couchbase-cli 테스트` &#x20;

\
몇 가지 일반적인 couchbase-cli 명령어를 실행해 보면서 인터페이스에 익숙해집니다.

\
먼저 Cluster-IPs 스프레드시트에서 Couchbase 호스트 이름을 가져옵니다. 이 이름은 다음과 같이 표시됩니다:

```
ec2-54-85-43-128.compute-1.amazonaws.com
```

\
CLI 명령어의 기본 사용 형식은 다음과 같습니다:

```bash
couchbase-cli COMMAND [BUCKET_NAME] CLUSTER [OPTIONS]
```



명령어에 대한 CLUSTER 지정은 다음과 같은 긴 형식으로 제공됩니다:

```
--cluster=HOST[:PORT]
```

OPTIONS 부분에는 명령어 실행에 필요한 사용자 이름과 비밀번호가 포함됩니다. 이 값들은 .bashrc 파일에서 변수로 설정해 두었습니다.

마지막으로 `server-list` 명령을 실행합니다. 이 명령에서는 공용 호스트 이름과 포트를 명시해야 합니다.

{% hint style="danger" %}
호스트 이름 변수를 설정하지 않았다면, 아래의 hostname을 해당 서버의 public hostname으로 변경해야 합니다!
{% endhint %}

NODE1-8 변수와 로그인 및 비밀번호 변수를 선언했다면, 명령어는 다음과 같이 되어야 합니다:

```bash
[ec2-user@Couchbase01 ~]$ couchbase-cli server-list --cluster=$NODE1:8091
```

이 작업을 하지 않았다면, 다음을 직접 입력해야 합니다:

```bash
[ec2-user@Couchbase01 ~]$ couchbase-cli server-list --cluster=ec2-54-174-65-105.compute-1.amazonaws.com:8091 --username=Administrator
--password=couchbase
```

출력:&#x20;

```
ns_1@ec2-54-174-65-105.compute-1.amazonaws.com ec2-54-174-65-105.compute-1.amazonaws.com:8091 healthy active
```



### server-info 명령을 실행합니다.

이 명령은 사용자 이름과 비밀번호도 필요합니다:

```bash
[ec2-user@Couchbase01 ~]$ couchbase-cli server-info --cluster=$NODE1:8091
```

```json
{
  "addressFamily": "inet",
  "addressFamilyOnly": false,
  "availableStorage": {
    "hdd": [
      {
        "path": "/dev",
        "sizeKBytes": 3946352,
        "usagePercent": 0
      },
      {
        "path": "/dev/shm",
        "sizeKBytes": 3976212,
        "usagePercent": 0
      },
      {
        "path": "/run",
        "sizeKBytes": 3976212,
        "usagePercent": 2
      },
      {
        "path": "/sys/fs/cgroup",
        "sizeKBytes": 3976212,
        "usagePercent": 0
      },
      {
        "path": "/",
        "sizeKBytes": 31444972,
        "usagePercent": 14
      },
      {
        "path": "/run/user/1000",
        "sizeKBytes": 795240,
        "usagePercent": 0
      }
    ]
  },
  "cbasMemoryQuota": 1522,
  "clusterCompatibility": 458752,
  "clusterMembership": "active",
  "configuredHostname": "ec2-18-144-66-225.us-west-1.compute.amazonaws.com:8091",
  "couchApiBase": "http://ec2-18-144-66-225.us-west-1.compute.amazonaws.com:8092/",
  "couchApiBaseHTTPS": "https://ec2-18-144-66-225.us-west-1.compute.amazonaws.com:18092/",
  "cpuCount": 2,
  "eventingMemoryQuota": 256,
  "externalListeners": [
    {
      "afamily": "inet",
      "nodeEncryption": true
    }
  ],
  "ftsMemoryQuota": 512,
  "hostname": "ec2-18-144-66-225.us-west-1.compute.amazonaws.com:8091",
  "indexMemoryQuota": 512,
  "interestingStats": {
    "cmd_get": 0,
    "couch_docs_actual_disk_size": 100813615,
    "couch_docs_data_size": 52864293,
    "couch_spatial_data_size": 0,
    "couch_spatial_disk_size": 0,
    "couch_views_actual_disk_size": 914688,
    "couch_views_data_size": 914688,
    "curr_items": 71177,
    "curr_items_tot": 71177,
    "ep_bg_fetched": 0,
    "get_hits": 0,
    "index_data_size": 66334738,
    "index_disk_size": 48733247,
    "mem_used": 146574552,
    "ops": 0,
    "vb_active_num_non_resident": 0,
    "vb_replica_curr_items": 0
  },
  "mcdMemoryAllocated": 6212,
  "mcdMemoryReserved": 6212,
  "memoryFree": 5622059008,
  "memoryQuota": 2024,
  "memoryTotal": 8143282176,
  "nodeEncryption": true,
  "nodeUUID": "60cd845f0889dcf8f667acb1acfb8f10",
  "os": "x86_64-unknown-linux-gnu",
  "otpCookie": "759942fcf0dd91aff552d2c362b8aafdd3646a437f408a33c8dd423137cec27d",
  "otpNode": "ns_1@ec2-18-144-66-225.us-west-1.compute.amazonaws.com",
  "ports": {
    "direct": 11210,
    "distTCP": 21100,
    "distTLS": 21150,
    "httpsCAPI": 18092,
    "httpsMgmt": 18091
  },
  "recoveryType": "none",
  "services": [
    "index",
    "kv",
    "n1ql"
  ],
  "status": "healthy",
  "storage": {
    "hdd": [
      {
        "cbas_dirs": [
          "/opt/couchbase/var/lib/couchbase/analytics"
        ],
        "eventing_path": "/opt/couchbase/var/lib/couchbase/eventing",
        "index_path": "/opt/couchbase/var/lib/couchbase/indexes",
        "java_home": "",
        "path": "/opt/couchbase/var/lib/couchbase/data",
        "quotaMb": "none",
        "state": "ok"
      }
    ],
    "ssd": []
  },
  "storageTotals": {
    "hdd": {
      "free": 27691700143,
      "quotaTotal": 32199651328,
      "total": 32199651328,
      "used": 4507951185,
      "usedByData": 101728303
    },
    "ram": {
      "quotaTotal": 2122317824,
      "quotaTotalPerNode": 2122317824,
      "quotaUsed": 629145600,
      "quotaUsedPerNode": 629145600,
      "total": 8143282176,
      "used": 5543067648,
      "usedByData": 146574552
    }
  },
  "systemStats": {
    "allocstall": 0,
    "cpu_cores_available": 2,
    "cpu_stolen_rate": 0.3139717425431711,
    "cpu_utilization_rate": 7.901622187336473,
    "mem_free": 5622059008,
    "mem_limit": 8143282176,
    "mem_total": 8143282176,
    "swap_total": 0,
    "swap_used": 0
  },
  "thisNode": true,
  "uptime": "1205876",
  "version": "7.1.0-5303-enterprise"
```

\
